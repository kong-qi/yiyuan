<extend name="Layout:index"/>
<block name="add_css">
    <link rel="stylesheet" href="__CSS__/sweetalert.css">
</block>
<block name="add_js">
    <script src="__JS__/sweetalert.min.js"></script>

</block>
<block name="right">
    <php>$status=yuyue_status()</php>
    <div class="right-box">
        
        <div class="ibox">
            
                <form action='' method="get" id="contact-form">
                    <input type="hidden" name="is_search" value="1">
                     <php>
                        $is_search_on="";
                       
                        if($is_search==0)
                        {
                            $is_search_on="display: none;";
                        }
                    </php>
                    <div class="col-sm-12" style="padding:0px;margin-bottom: 0">
                        <div class="ibox float-e-margins" >
                            <div class="ibox-title">
                                <h5><a class="collapse-link">{{ :lang('筛查选项') }}</a></h5>
                                <div class="ibox-tools">
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-down" id="shoujisf2"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="ibox-content" style="padding-left:0px; padding-right:0px; {{ :$is_search_on }}" >
                                <div class="roww">
                                    
                                    <div class="col-sm-3">
                                        <div class="input-group m-b">
                                            <span class="input-group-addon"><font color="">{{ :lang('关键词','handle') }}</font></span>
                                            <input name="keyword" type="text" value="{{ :I('get.keyword') }}"
                                                   placeholder="{{ :lang('姓名/手机/回访主题') }}" class="form-control">
                                        </div>
                                    </div>
                                    <div class="col-sm-3">
                                        
                                        <button class="btn btn-primary" type="submit">{{ :lang('确定筛选','handle') }}</button>

                                       <a href="" class="btn btn-success" type="reset">{{ :lang('清空','handle') }}</a>

                                    </div>


                                </div>
                               
                            </div>
                        </div>
                    </div>
                </form>
            
        </div>
       
        <div class="ibox">

          


                <if condition="$menu_list">
                    <div class="ibox-title">
                        <h5><a class="collapse-link">{{ :lang('字段选择','handle') }}</a>

                            <div class="keep-open btn-group open" title="列">
                                <div class="dropdown">
                                    <button type="button" class="btn btn-default btn-outline dropdown-toggle"
                                            data-toggle="dropdown" aria-expanded="true"
                                            style="padding:0px 5px; border:0px">
                                        <i class="glyphicon glyphicon-list"></i>
                                        <span class="caret"></span>
                                    </button>


                                    <ul class="dropdown-menu" role="menu" style=" padding:10px">
                                        <foreach name="menu_list" item="v" key="k">
                                            <if condition="$v['name'] neq ''">
                                            <li>
                                                <div class="checkbox-inline f-label">
                                                    <php>
                                                    $active='checked=""';
                                                    if($v['is_hide']==1)
                                                    {
                                                         $active='';
                                                    }
                                                    </php>
                                                   
                                                    <input type="checkbox" {{ $active }} data-change="select" data-class="{{ $k }}">
                                                    <label>{{ $v['name'] }}</label>
                                                      
                                                   
                                                </div>
                                            </li>
                                            </if>
                                        </foreach>


                                    </ul>
                                </div>
                            </div>
                        </h5>

                    </div>

                </if>
                <div class="ibox-content">
                    <div class="table-responsive">
                        <table width="100%"  class="table table-striped table-hover table-bordered">

                            <tbody>

                            <tr>
                                <th width="40" class="hidden-xs text-center"><input name="chkall" type="checkbox" id="chkall" value="0"></th>

                                  
                                    <foreach name="menu_list" item="v" key="k">
                                        <if condition="$v['name'] neq ''">

                                            <if condition="$v['is_hide'] neq 1">
                                                    <th class="{{ $k }}">{{ $v['name'] }}</th>
                                                <else/>
                                                    <th class="{{ $k }}" style="display: none;">{{ $v['name'] }}</th>
                                            </if> 
                                           
                                        </if>
                                       
                                    </foreach>
                                <th>{{ :lang('操作') }}</th>

                            </tr>
                            <if condition="$list">

                                <volist name="list" id="v">

                                    <tr class="js-tr">

                                        <td align="center" class="hidden-xs">
                                            <input type="checkbox" class="checkbox-select" name="checkbox[]" value="{{ $v.yuuid }}">
                                        </td>
                                        
                                        <foreach name="menu_list" item="mv" key="mk">
                                            <?php
                                                $ishow="";
                                                if($mv['is_hide']==1)
                                                {
                                                     $ishow='style="display: none"';
                                                }
                                            ?>
                                           
                                            <td class="{{ $mk }} {{ $mv['diy'] }}" {{ $ishow }}>
                                            
                                            <if condition="$mv['is_time']">
                                                    {{ :to_time($v[$mv['filed']]) }}
                                                <elseif condition="$mv['filed'] eq status"/>

                                                  <span class="{{ :btn_yycolor(($v['status']+1)) }}">
                                                  {{ :lang(ren_status($v[$mv['filed']])) }}
                                                  </span>
                                                <elseif condition="$mv['filed'] eq tel"/>
                                                <a href="javascript:void(0)" data-show-phone="1" data-url="{{ :U('Admin/Ajax/showPhone') }}" data-vid="#showphone" id="showphone" data-uid="{{ $v.user_id }}">{{ :hide_tel($v['tel'],2,5) }}</a>
                                                <else/>
                                                    {{ $v[$mv['filed']] }}
                                            </if>
                                            
                                            </td>
                                        </foreach>
                                        <td>
                                            <div style="width: 230px;">
                                                <include file="Menu:renwu" />
                                             </div>
                                            

                                        </td>
                                      
                                        
                                    </tr>
                                   

                                </volist>

                                <else/>
                                <tr>
                                    <td colspan="8" class="text-center">{{ :C('NOTTHING') }}</td>
                                </tr>
                            </if>
                            </tbody>


                        </table>
                    </div>
                     <div class="pagee m-t">
                        <div class="pull-right">
                            {{ $page }}
                        </div>
                     </div>

                </div>
                

            </div>
            <div class="cl"></div>
        </div>


    </div>


</block>
<block name="add_foot_js">
    <script src="__JS__/plugins/layer/laydate/laydate.js"></script>
    <script>
         $(".js-open-more").click(function () {

            $p = $(this).parents(".js-tr").next();

            if ($p.is(":hidden")) {
                $p.show();
                $(this).find('span').removeClass('fa-plus-square-o').addClass('fa-minus-square-o');
            } else {
                $p.hide();
                $(this).find('span').removeClass('fa-minus-square-o').addClass('fa-plus-square-o');
            }
        });

   
       
    </script>
   
    <script>
        $(function () {
            select_all();
            del_confirm();


 
            $(document).on("click", "[data-handle-check='1']", function () {
                $uuid = checked_box_id();
                $model = $(this).attr('data-model');
                $type = $(this).attr('data-handle');
                $value = $(this).attr('data-handle-value');
                $filed = $(this).attr('data-handle-filed');
                $sort = checked_sort_id();
                $log = "{{ $onname }}：" + checked_log_name();
                //console.log($uuid);
                //console.log($sort);
                //console.log($log);

                if ($uuid) {
                    switch ($type) {

                        default:

                            swal({
                                        title: "{{ :lang('你确定批量操作吗','handle') }}?",
                                        type: "warning",
                                        showCancelButton: true,
                                        confirmButtonColor: "#DD6B55",
                                        confirmButtonText: "{{ :lang('确定','handle') }}",
                                        cancelButtonText: "{{ :lang('取消','handle') }}",
                                        closeOnConfirm: false,
                                        showLoaderOnConfirm: true,
                                    },
                                    function () {
                                        setTimeout(function () {
                                            $.ajax({
                                                'url': '{{ :U("Admin/Ajax/handle") }}',
                                                type: 'post',
                                                data: {
                                                    'uuid': $uuid,
                                                    'model': $model,
                                                    'value': $value,
                                                    'type': $type,
                                                    'filed': $filed,
                                                    'sort': $sort,
                                                    'log': $log,
                                                    'token': '{{ :token() }}'
                                                },
                                                cache: false,
                                                dataType: 'json',
                                                success: function (data) {
                                                    console.log(data);
                                                    if (data.error == 0) {
                                                        swal({
                                                            title: data.msg,
                                                            confirmButtonText: "{{ :lang('确定','handle') }}",
                                                            type: "success",
                                                            timer: 1000,
                                                        });
                                                        window.location.reload();
                                                    } else {
                                                        swal({
                                                            title: data.msg,
                                                            confirmButtonText: "{{ :lang('确定','handle') }}",
                                                            type: "warning",
                                                            timer: 1000,
                                                        });

                                                    }
                                                    ;
                                                }
                                            })
                                        }, 2000);
                                    }
                            );
                            break;
                    }

                } else {
                    swal("{{ :lang('没有选择','handle') }}");
                }

            });
            

        });
        
     
        


    </script>

</block>